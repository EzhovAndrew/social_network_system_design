# Social network system design
Репозиторий создан для прохождения [курса](https://balun.courses/courses/system_design) по System Design

## Функциональные требования
1. Возможность опубликовать пост.
2. Пост должен содержать в себе текстовое описание, фотографии и привязку к месту путешествия
3. Возможность поставить лайк посту и оставить под ним комментарий
4. Возможность подписаться/отписаться на/от других пользователей
5. Поиск популярных мест для путешествий и просмотр постов с этих мест
6. Просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке
7. Поддерживается и мобильная и десктопная версии

## Нефункциональные требования

1. Количество ежедневно активных пользователей(DAU) - 10 000 000
2. Количество пользователей будет постоянно и плавно расти, без резких скачков или спадов.
3. Целевые регионы - только страны СНГ
4. Целевая возрастная категория - все возраста
5. Наличие сезонности - да, сезоны отпусков летом, новогодние и майские праздники, множитель сезона - 4
6. Данные храним всегда
7. Доступность - 99.95%
8. Поведение пользователя в среднем в обычное время:
   * 1 пост в неделю
   * 2-4 фотографии в посте
   * 10 комментариев в день
   * 40 лайков в день
   * 1 подписка в 2-3 дня
   * 1 отписка в неделю
   * 6 просмотров ленты в день
   * 2-3 поиска по месту в неделю
9. Лимиты:
   * максимальное количество подписок - 10 000
   * максимальное количество подписчиков - неограничено
   * максимальное количество постов в день - 100
   * максимальное количество символов в описании поста - 5000
   * максимальное количество фотографий в посте - 5
   * максимальное количество комментариев в день - 1000
   * максимальный размер фотографии - 1Mb
   * максимальное количество символов в комментарии - 500
10. Временные ограничения:
   * Публикация поста - до 5 секунд
   * Поставить лайк, оставить комментарий, подписаться, отписаться - до 1 секунды
   * Появление поста в ленте подписчика - до 30 секунд
   * Просмотр своей ленты - до 2 секунд
   * Просмотр ленты другого пользователя - до 2 секунд
   * Просмотр ленты по привязке к месту - до 3 секунд

## Расчет нагрузки

```Одновременных соединений - 10 000 000 * 0.1 = 1 000 000```

### Структуры данных для пересылки

1. Like - 16b
   * user_id - 8b
   * post_id - 8b

2. Comment - 1Kb
   * user_id - 8b
   * post_id - 8b
   * text - 1Kb

3. Post - 10Kb
   * user_id - 8b
   * geo_id - 8b
   * description - 10Kb
   * photos_ids - 5 * 8byte = 40byte

4. Photo - 1Mb(учитывая допустимый размер фотографий, размером метаданных можно пренебречь, на порядок величины они не повлияют)

### Посты 

Пагинация ленты - 20 постов на странице
```
RPS(в обычное время) - 10 000 000 * 6 / 86400 = 694 RPS
RPS(в обычное время) - 10 000 000 * 1 / 7 / 86400 = 17 RPS
```
```
Traffic(в обычное время) - 694 RPS * 10Kb * 20 = 137 Mb/s
Traffic(в обычное время) - 17 RPS * 10Kb * 20 = 3.36 Mb/s
```

### Лайки
```
RPS(в обычное время) = RPS(выдача постов в ленту в обычное время) = 694 RPS
RPS(в обычное время) = 10 000 000 * 40 / 86400 = 4630 RPS
```
```
Traffic(в обычное время) = 694 RPS * 16b = 10.84 Kb/s
Traffic(в обычное время) = 4630 RPS * 16b = 72.34 Kb/s
```

### Комментарии

Пагинация - 20 комментариев к посту

```
RPS(в обычное время) = RPS(выдача постов в ленту в обычное время) = 694 RPS
RPS(в обычное время) = 10 000 000 * 10 / 86400 = 1157 RPS
```
```
Traffic(в обычное время) = 694 RPS * 1Kb * 20 = 14 Mb/s
Traffic(в обычное время) = 1157 RPS * 1Kb * 20 = 23 Mb/s
```

### Фотографии
```
RPS(в обычное время) = RPS(выдача постов в ленту в обычное время) * 3 = 694 RPS * 3 = 2082 RPS
RPS(в обычное время) = RPS(публикация постов в обычное время) * 3 = 17 RPS * 3 = 51 RPS
```
```
Traffic(в обычное время) = 2082 RPS * 1Mb = 2 Gb/s
Traffic(в обычное время) = 51 RPS * 1Mb = 20 Mb/s
```