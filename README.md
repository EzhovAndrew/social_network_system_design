# Social network system design
Репозиторий создан для прохождения [курса](https://balun.courses/courses/system_design) по System Design

## Функциональные требования
1. Возможность опубликовать пост.
2. Пост должен содержать в себе текстовое описание, фотографии и привязку к месту путешествия
3. Возможность поставить лайк посту и оставить под ним комментарий
4. Возможность подписаться/отписаться на/от других пользователей
5. Поиск популярных мест для путешествий и просмотр постов с этих мест
6. Просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке
7. Поддерживается и мобильная и десктопная версии

## Нефункциональные требования

1. Количество ежедневно активных пользователей(DAU) - 10 000 000
2. Количество пользователей будет постоянно и плавно расти, без резких скачков или спадов.
3. Целевые регионы - только страны СНГ
4. Целевая возрастная категория - все возраста
5. Наличие сезонности - да, сезоны отпусков летом, новогодние и майские праздники
6. Данные храним всегда
7. Доступность - 99.95%
8. Поведение пользователя:
   - В среднем в обычное время:
     * 1 пост в неделю
     * 2-4 фотографии в посте
     * 10 комментариев в день
     * 40 лайков в день
     * 1 подписка в 2-3 дня
     * 1 отписка в неделю
     * 6 просмотров ленты в день
     * 2-3 поиска по месту в неделю
   - В среднем в сезонность:
     * 10 постов в неделю
     * 5-10 фотографий в посте
     * 30 комментариев в день
     * 100 лайков в день
     * 2-3 подписки в день
     * 1 отписка в день
     * 10 просмотров ленты в день
     * 5 поисков по месту в день
9. Лимиты:
   * максимальное количество подписок - 10 000
   * максимальное количество подписчиков - неограничено
   * максимальное количество постов в день - 100
   * максимальное количество символов в описании поста - 5000
   * максимальное количество фотографий в посте - 10
   * максимальное количество комментариев в день - 1000
   * максимальный размер фотографии - 1Mb
   * максимальное количество символов в комментарии - 500
10. Временные ограничения:
   * Публикация поста - до 10 секунд
   * Поставить лайк, оставить комментарий, подписаться, отписаться - до 1 секунды
   * Появление поста в ленте подписчика - до 30 секунд
   * Просмотр своей ленты - до 2 секунд
   * Просмотр ленты другого пользователя - до 2 секунд
   * Просмотр ленты по привязке к месту - до 3 секунд

## Расчет нагрузки

```Одновременных соединений - 10 000 000 * 0.1 = 1 000 000```

### Структуры данных для пересылки

1. Like - 16b
   * user_id - 8b
   * post_id - 8b

2. Comment - 1040b
   * user_id - 8b
   * post_id - 8b
   * text - 1Kb

3. Post - 10336b
   * user_id - 8b
   * geo_id - 8b
   * description - 10Kb
   * photos_ids - 10 * 8byte = 80byte

4. Photo - 1Mb(учитывая допустимый размер фотографий, размером метаданных можно пренебречь, на порядок величины они не повлияют)

### Посты 

Пагинация ленты - 20 постов на странице
```
RPS(выдача постов в ленту в обычное время) - 10 000 000 * 6 / 86400 = 694 RPS
RPS(выдача постов в ленту в сезонность) - 10 000 000 * 10 / 86400 = 1157 RPS
RPS(публикация постов в обычное время) - 10 000 000 * 1 / 7 / 86400 = 17 RPS
RPS(публикация постов в сезонность) - 10 000 000 * 10 / 7 / 86400 = 170 RPS
```
```
Traffic(выдача постов в ленту в обычное время) - 694 RPS * 10336 * 20 = 137 Mb/s
Traffic(выдача постов в ленту в сезонность) - 1157 RPS * 10336 * 20 = 228 Mb/s
Traffic(публикация постов в обычное время) - 17 RPS * 10336 * 20 = 3.36 Mb/s
Traffic(публикация постов в сезонность) - 170 RPS * 10336 * 20 = 33.6 Mb/s
```

### Лайки
```
RPS(чтение в обычное время) = RPS(выдача постов в ленту в обычное время) = 694 RPS
RPS(чтение в сезонность) = RPS(выдача постов в ленту в сезонность) = 1157 RPS
RPS(запись в обычное время) = 10 000 000 * 40 / 86400 = 4630 RPS
RPS(запись в сезонность) = 10 000 000 * 100 / 86400 = 11574 RPS
```
```
Traffic(чтение в обычное время) = 694 RPS * 16b = 10.84 Kb/s
Traffic(чтение в сезонность) = 1157 RPS * 16b = 18 Kb/s
Traffic(запись в обычное время) = 4630 RPS * 16b = 72.34 Kb/s
Traffic(запись в сезонность) = 11574 RPS * 16b = 180.84 Kb/s
```

### Комментарии

Пагинация - 20 комментариев к посту

```
RPS(чтение в обычное время) = RPS(выдача постов в ленту в обычное время) = 694 RPS
RPS(чтение в сезонность) = RPS(выдача постов в ленту в сезонность) = 1157 RPS
RPS(запись в обычное время) = 10 000 000 * 10 / 86400 = 1157 RPS
RPS(запись в сезонность) = 10 000 000 * 30 / 86400 = 3471 RPS
```
```
Traffic(чтение в обычное время) = 694 RPS * 1040b * 20 = 14 Mb/s
Traffic(чтение в сезонность) = 1157 RPS * 1040b * 20 = 23 Mb/s
Traffic(запись в обычное время) = 1157 RPS * 1040b * 20 = 23 Mb/s
Traffic(запись в сезонность) = 3471 RPS * 1040b * 20 = 69 Mb/s
```

### Фотографии
```
RPS(просмотр в обычное время) = RPS(выдача постов в ленту в обычное время) * 3 = 694 RPS * 3 = 2082 RPS
RPS(просмотр в сезонность) = RPS(выдача постов в ленту в сезонность) * 6 = 1157 RPS * 6 = 6942 RPS
RPS(загрузка в обычное время) = RPS(публикация постов в обычное время) * 3 = 17 RPS * 3 = 51 RPS
RPS(загрузка в сезонность) = RPS(публикация постов в сезонность) * 6 = 170 RPS * 6 = 1020 RPS
```
```
Traffic(просмотр в обычное время) = 2082 RPS * 1Mb = 2 Gb/s
Traffic(просмотр в сезонность) = 6942 RPS * 1Mb = 7 Gb/s
Traffic(загрузка в обычное время) = 51 RPS * 1Mb = 20 Mb/s
Traffic(загрузка в сезонность) = 1020 RPS * 1Mb = 1 Gb/s
```